# Elevation input
-----
This directory contains a script to derive a gridded dataset of elevation for
an existing grid.

## Input
You will need a source dataset providing gridded elevation data. 
For example, NOAA National Centers for Environmental Information (NCEI) provides
the ETOPO1 Global Relief Model at 1 arc-minute spatial resolution:
https://www.ngdc.noaa.gov/mgg/global/global.html

Alternatively, IIASA provides "Global Terrain Slope and Aspect Data" as
supplementary data to its Harmonized World Soil Database (HWSD):
https://webarchive.iiasa.ac.at/Research/LUC/External-World-soil-database/HTML/global-terrain-slope-download.html?sb=7

Other gridded elevation data may be used as well as long as it is in a
single-file raster format.

The sample application is for ETOPO1 data using 2 grid files as generated by the
scripts in `../gadm_paper` at 5 arc-minute and 30 arc-minute spatial resolution.

## Software requirements
You will need the Generic Mapping Tools (GMT) to resample ETOPO1 data. GMT is
available for Windows, MacOS and Linux from
https://www.generic-mapping-tools.org/

You also need `R` and the R package `raster` to run elevation_input.R

## Files included in this directory
  - download_and_resample_etopo.sh: shell script which downloads global ETOPO1
    data and resamples it to the target resolution
  - elevation_input.R: script to derive elevation input for a specified grid
    from elevation source dataset
  - README.md: this file
  - r_modules.sh: bash script that loads all required modules to run R script
    on the PIK cluster

## How to use
  - Shell script download_and_resample_etopo.sh will download ETOPO1 global
    data from NOAA National Centers for Environmental Information and resample
    it to the target resolution.
  - Script elevation_input.R will extract elevation for all cells included in
    `gridname` and write an elevation file in either LPJmL input format or as a
    CSV table. Elevation source data must be in a format supported by the
    `raster` package in R and must be in the correct resolution already. This
    can be created by `download_and_resample_etopo.sh` or elevation data from
    any other source.

## Setup in download_and_resample_etopo.sh for sample application
  - Set `xres` and `yres` to either "5m" or "30m" resolution.

### Additional settings in download_and_resample_etopo.sh
  - `etopo1_src_url`: remote address of ETOPO1 source data
  - `etopo_src_local`: local filename to use for ETOPO1 source data
  - `download_etopo1`: either TRUE or FALSE; set to TRUE for first resolution,
    FALSE for second resolution
  - `resample_operation`: either AGGREGATE or DISAGGREGATE. "AGGREGATE" used
  - `aggregation_function`: use either "blockmean" or "blockmedian" to aggregate
    data. Default used: blockmedian
  - `mask_ocean`: ETOPO1 data includes ocean floors. Set `mask_ocean` to TRUE
    (default) to prevent coastal cells to be averaged across land and ocean which
    leads to elevation below sea level.
  - `etopo1_tgt_name`: filename of resampled elevation data 
    (`aggregation_function` is added to this filename later in the script)
  - See additional parameters used by GMT for resampling
 
## Setup in elevation_input.R for sample application
  - Set `elevationdir` to current working directory.
  - Set `gridname` to point to one of 2 grid files generated by scripts in
    `../gadm_paper`; set `gridformat` to "BIN".
  - Set `lpj_res` to resolution matching currently selected grid file.
  - Set `elevation_source_name` to point to one of 2 elevation datasets
    resampled by `download_and_resample_etopo.sh`
  - Set `elevationformat` to LPJmL input format.
